<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>å¯¶å¯¶èªçŸ¥æŒ‘æˆ° Pro+</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <style>
        :root { 
            --bg: #FFF9E3; 
            --primary: #FF6B6B; 
            --success: #4CAF50; 
            --wrong: #f44336;
            --accent: #FFD93D;
        }
        
        body { 
            margin: 0; 
            background: var(--bg); 
            font-family: "PingFang TC", "Microsoft JhengHei", sans-serif; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            -webkit-user-select: none; 
            padding-top: env(safe-area-inset-top); 
            overflow-x: hidden;
        }

        /* æ¨™é¡Œèˆ‡ç‹€æ…‹æ¬„ */
        .quiz-status { 
            font-size: 28px; 
            font-weight: bold; 
            color: #555; 
            margin: 20px 0; 
            min-height: 42px; 
            text-shadow: 1px 1px 0 white;
            transition: color 0.3s;
            z-index: 2;
        }
        .quiz-status.highlight { color: var(--primary); }

        /* æ¨¡å¼åˆ‡æ› */
        .mode-switch { margin-bottom: 20px; display: flex; gap: 10px; z-index: 2;}
        .mode-btn { 
            padding: 10px 25px; 
            border-radius: 30px; 
            border: 3px solid var(--primary); 
            background: white; 
            color: var(--primary); 
            font-weight: bold; 
            font-size: 18px;
            cursor: pointer;
            transition: 0.2s;
        }
        .mode-btn.active { background: var(--primary); color: white; box-shadow: 0 4px 10px rgba(255,107,107,0.4); }

        /* å°è¦½åˆ— */
        .nav { display: flex; gap: 8px; margin-bottom: 25px; flex-wrap: wrap; justify-content: center; z-index: 2; max-width: 95%; }
        .nav-btn { 
            padding: 10px 14px; 
            border: none; 
            border-radius: 50px; 
            background: white; 
            box-shadow: 0 4px 0 var(--accent); 
            font-weight: bold; 
            font-size: 15px;
            cursor: pointer;
            transition: transform 0.1s, background 0.2s;
        }
        .nav-btn.active { background: var(--accent); transform: translateY(2px); box-shadow: 0 2px 0 #e6c435; }

        /* å¡ç‰‡å®¹å™¨ */
        .grid-container { 
            display: grid; 
            grid-template-columns: repeat(2, 1fr); 
            gap: 20px; 
            width: 90%; 
            max-width: 450px; 
            padding-bottom: 60px; 
            z-index: 2;
        }

        /* å¡ç‰‡æ¨£å¼ */
        .card { 
            background: white; 
            border-radius: 30px; 
            box-shadow: 0 8px 0 #eee; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            padding: 20px; 
            aspect-ratio: 1/1; 
            transition: transform 0.1s, box-shadow 0.1s, opacity 0.3s; 
            border: 4px solid transparent;
            cursor: pointer;
            position: relative;
        }
        .card:active { transform: translateY(4px); box-shadow: 0 2px 0 #eee; }
        /* åˆ‡æ›æ™‚çš„æ·¡å…¥æ•ˆæœ */
        .card.fade-in { opacity: 0; animation: fadeIn 0.5s forwards; }
        @keyframes fadeIn { to { opacity: 1; } }
        
        .emoji { font-size: 70px; margin-bottom: 10px; }
        .label { font-size: 22px; font-weight: bold; color: #444; }

        /* å‹•ç•«æ•ˆæœ - ç­”å° */
        @keyframes success-pulse {
            0% { transform: scale(1); border-color: var(--success); background-color: #e8f5e9; }
            50% { transform: scale(1.05); border-color: var(--success); background-color: #c8e6c9; }
            100% { transform: scale(1); border-color: var(--success); background-color: #e8f5e9; }
        }
        .correct { animation: success-pulse 0.6s infinite; border-color: var(--success) !important; z-index: 10; }

        /* å‹•ç•«æ•ˆæœ - ç­”éŒ¯ */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-10px); }
            40%, 80% { transform: translateX(10px); }
        }
        .wrong-shake { animation: shake 0.4s; border-color: var(--wrong) !important; background-color: #ffebee; }

        /* æ˜Ÿæ˜Ÿç‰¹æ•ˆ */
        .particle-container {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            z-index: 99;
        }
        .star-particle {
            position: absolute;
            font-size: 24px;
            animation: fly-out 1s ease-out forwards;
            opacity: 0;
        }
        @keyframes fly-out {
            0% { opacity: 1; transform: translate(0, 0) scale(0.5) rotate(0deg); }
            100% { opacity: 0; transform: translate(var(--tx), var(--ty)) scale(1.2) rotate(var(--rot)); }
        }
    </style>
</head>
<body>

    <div id="quiz-msg" class="quiz-status">è¼‰å…¥ä¸­...</div>

    <div class="mode-switch">
        <button id="btn-learn" class="mode-btn active" onclick="setMode('learn')">å­¸ç¿’æ¨¡å¼</button>
        <button id="btn-quiz" class="mode-btn" onclick="setMode('quiz')">æŒ‘æˆ°æ¨¡å¼</button>
    </div>

    <div class="nav">
        <button class="nav-btn active" onclick="changeCat('fruits', this)">ğŸ æ°´æœ</button>
        <button class="nav-btn" onclick="changeCat('animals', this)">ğŸ¶ å‹•ç‰©</button>
        <button class="nav-btn" onclick="changeCat('vehicles', this)">ğŸš— äº¤é€š</button>
        <button class="nav-btn" onclick="changeCat('numbers', this)">ğŸ”¢ æ•¸å­—</button>
    </div>

    <div id="grid" class="grid-container"></div>
    <div id="particle-layer" class="particle-container"></div>

    <script>
        // æ“´å……è³‡æ–™åº«ï¼Œè®“æ¯æ¬¡éš¨æ©ŸæŠ½å–æ›´æœ‰è®ŠåŒ–
        const ALL_DATA = {
            fruits: [
                {n:'è˜‹æœ', i:'ğŸ'}, {n:'é¦™è•‰', i:'ğŸŒ'}, {n:'è¥¿ç“œ', i:'ğŸ‰'}, 
                {n:'è‘¡è„', i:'ğŸ‡'}, {n:'è‰è“', i:'ğŸ“'}, {n:'æ©˜å­', i:'ğŸŠ'},
                {n:'é³³æ¢¨', i:'ğŸ'}, {n:'æ«»æ¡ƒ', i:'ğŸ’'}, {n:'æª¸æª¬', i:'ğŸ‹'},
                {n:'æ°´èœœæ¡ƒ',i:'ğŸ‘'}, {n:'å“ˆå¯†ç“œ',i:'ğŸˆ'}, {n:'å¥‡ç•°æœ',i:'ğŸ¥'}
            ],
            animals: [
                {n:'å°ç‹—', i:'ğŸ¶'}, {n:'å°è²“', i:'ğŸ±'}, {n:'å¤§è±¡', i:'ğŸ˜'}, 
                {n:'å…”å­', i:'ğŸ°'}, {n:'ç…å­', i:'ğŸ¦'}, {n:'é•·é ¸é¹¿', i:'ğŸ¦’'},
                {n:'è€è™', i:'ğŸ¯'}, {n:'çŒ´å­', i:'ğŸµ'}, {n:'å°è±¬', i:'ğŸ·'},
                {n:'ç†Šè²“', i:'ğŸ¼'}, {n:'å°é›', i:'ğŸ¤'}, {n:'ä¹³ç‰›', i:'ğŸ®'}
            ],
            vehicles: [
                {n:'æ±½è»Š', i:'ğŸš—'}, {n:'é£›æ©Ÿ', i:'âœˆï¸'}, {n:'è­¦è»Š', i:'ğŸš“'}, 
                {n:'è…³è¸è»Š', i:'ğŸš²'}, {n:'ç«è»Š', i:'ğŸš‚'}, {n:'èˆ¹', i:'ğŸš¢'},
                {n:'å…¬è»Š', i:'ğŸšŒ'}, {n:'è¨ˆç¨‹è»Š',i:'ğŸš•'}, {n:'æ¶ˆé˜²è»Š',i:'ğŸš’'},
                {n:'æ•‘è­·è»Š',i:'ğŸš‘'}, {n:'ç«ç®­', i:'ğŸš€'}, {n:'ç›´å‡æ©Ÿ',i:'ğŸš'}
            ],
            // æ–°å¢æ•¸å­—é¡åˆ¥
            numbers: [
                {n:'ä¸€', i:'1ï¸âƒ£'}, {n:'äºŒ', i:'2ï¸âƒ£'}, {n:'ä¸‰', i:'3ï¸âƒ£'},
                {n:'å››', i:'4ï¸âƒ£'}, {n:'äº”', i:'5ï¸âƒ£'}, {n:'å…­', i:'6ï¸âƒ£'},
                {n:'ä¸ƒ', i:'7ï¸âƒ£'}, {n:'å…«', i:'8ï¸âƒ£'}, {n:'ä¹', i:'9ï¸âƒ£'},
                {n:'å', i:'ğŸ”Ÿ'}, {n:'é›¶', i:'0ï¸âƒ£'}
            ]
        };

        let currentMode = 'learn';
        let currentCat = 'fruits';
        let currentGridItems = []; // ç›®å‰ç•«é¢ä¸Šé¡¯ç¤ºçš„6å€‹é …ç›®
        let targetItem = null;
        let isProcessing = false;

        // èªéŸ³åŠŸèƒ½
        function speak(txt, rate = 0.75) {
            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel();
                const u = new SpeechSynthesisUtterance(txt);
                u.lang = 'zh-TW';
                u.rate = rate; 
                u.pitch = 1.1; 
                window.speechSynthesis.speak(u);
            }
        }

        // æ ¸å¿ƒåŠŸèƒ½ï¼šå¾å¤§é¡Œåº«ä¸­éš¨æ©ŸæŒ‘é¸ 6 å€‹ä¸é‡è¤‡çš„é …ç›®
        function pickRandomGridItems() {
            // è¤‡è£½ä¸€ä»½ç•¶å‰é¡åˆ¥çš„æ‰€æœ‰è³‡æ–™
            let pool = [...ALL_DATA[currentCat]];
            // Fisher-Yates æ´—ç‰Œç®—æ³• (æ¯” Math.random() - 0.5 æ›´éš¨æ©Ÿ)
            for (let i = pool.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [pool[i], pool[j]] = [pool[j], pool[i]];
            }
            // å–å‰ 6 å€‹
            currentGridItems = pool.slice(0, 6);
        }

        function setMode(mode) {
            currentMode = mode;
            isProcessing = false;
            document.getElementById('btn-learn').classList.toggle('active', mode === 'learn');
            document.getElementById('btn-quiz').classList.toggle('active', mode === 'quiz');
            
            const msgEl = document.getElementById('quiz-msg');
            if (mode === 'quiz') {
                msgEl.classList.add('highlight');
                // åˆ‡æ›åˆ°æŒ‘æˆ°æ¨¡å¼æ™‚ï¼Œé‡æ–°æ´—ç‰Œä¸¦å‡ºé¡Œ
                pickRandomGridItems();
                render(true); // true ä»£è¡¨éœ€è¦æ·¡å…¥å‹•ç•«
                setTimeout(startNewQuestion, 500); // ç¨å¾®å»¶é²ç­‰å¾…å¡ç‰‡å‡ºç¾
            } else {
                msgEl.classList.remove('highlight');
                msgEl.innerText = "é»ä¸€é»ï¼Œå­¸èªªè©±";
                speak("å­¸ç¿’æ¨¡å¼");
                render();
            }
        }

        function changeCat(cat, btn) {
            currentCat = cat;
            isProcessing = false;
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            
            // åˆ‡æ›é¡åˆ¥æ™‚ï¼Œé‡æ–°æ´—ç‰Œ
            pickRandomGridItems();
            render(true);

            if (currentMode === 'quiz') {
                setTimeout(startNewQuestion, 500);
            } else {
                speak(btn.innerText.split(' ')[1]);
                document.getElementById('quiz-msg').innerText = "é»ä¸€é»ï¼Œå­¸èªªè©±";
            }
        }

        function startNewQuestion() {
            if (currentGridItems.length === 0) return;
            // å¾ç›®å‰çš„ 6 å€‹é¸é …ä¸­æŒ‘ä¸€å€‹ç•¶ç›®æ¨™
            targetItem = currentGridItems[Math.floor(Math.random() * currentGridItems.length)];
            document.getElementById('quiz-msg').innerText = `è«‹æ‰¾åˆ°ã€Œ${targetItem.n}ã€`;
            speak(`è«‹æ‰¾åˆ°ï¼Œ${targetItem.n}`);
        }

        // æ˜Ÿæ˜Ÿç‰¹æ•ˆå‡½æ•¸
        function triggerStars(x, y) {
            const container = document.getElementById('particle-layer');
            const numStars = 12; // æ˜Ÿæ˜Ÿæ•¸é‡
            for (let i = 0; i < numStars; i++) {
                const star = document.createElement('div');
                star.className = 'star-particle';
                star.innerText = 'â­';
                star.style.left = x + 'px';
                star.style.top = y + 'px';
                
                // éš¨æ©Ÿå™´å°„æ–¹å‘å’Œæ—‹è½‰è§’åº¦
                const angle = (i / numStars) * 360 + Math.random() * 30;
                const dist = 100 + Math.random() * 80;
                const tx = Math.cos(angle * Math.PI / 180) * dist;
                const ty = Math.sin(angle * Math.PI / 180) * dist;
                const rot = Math.random() * 360;
                
                star.style.setProperty('--tx', `${tx}px`);
                star.style.setProperty('--ty', `${ty}px`);
                star.style.setProperty('--rot', `${rot}deg`);
                
                container.appendChild(star);
                // å‹•ç•«çµæŸå¾Œç§»é™¤å…ƒç´ 
                setTimeout(() => star.remove(), 1000);
            }
        }

        function handleTap(item, el) {
            if (isProcessing) return;

            if (currentMode === 'learn') {
                speak(item.n);
                el.style.transform = "scale(0.95)";
                setTimeout(() => el.style.transform = "scale(1)", 100);
            } else {
                if (item.n === targetItem.n) {
                    // ç­”å°äº†ï¼
                    isProcessing = true;
                    el.classList.add('correct');
                    speak("ç­”å°äº†ï¼ä½ çœŸæ£’", 0.8);
                    
                    // å–å¾—é»æ“Šä½ç½®ä¸­å¿ƒé»ï¼Œè§¸ç™¼æ˜Ÿæ˜Ÿ
                    const rect = el.getBoundingClientRect();
                    const centerX = rect.left + rect.width / 2;
                    const centerY = rect.top + rect.height / 2;
                    triggerStars(centerX, centerY);

                    // ç­‰å¾…å‹•ç•«å’ŒèªéŸ³çµæŸå¾Œï¼Œåˆ·æ–°é¡Œç›®
                    setTimeout(() => {
                        el.classList.remove('correct');
                        isProcessing = false;
                        // === é—œéµä¿®æ”¹ï¼šç­”å°å¾Œé‡æ–°æ´—ç‰Œ ===
                        pickRandomGridItems();
                        render(true); // å¸¶å‹•ç•«é‡æ–°æ¸²æŸ“
                        setTimeout(startNewQuestion, 500);
                    }, 1800); // ç¨å¾®å»¶é•·ç­‰å¾…æ™‚é–“è®“æ˜Ÿæ˜Ÿé£›å®Œ
                } else {
                    // ç­”éŒ¯äº†
                    el.classList.add('wrong-shake');
                    speak("ä¸å°å–”ï¼Œå†è©¦è©¦çœ‹");
                    setTimeout(() => el.classList.remove('wrong-shake'), 500);
                }
            }
        }

        // æ¸²æŸ“å¡ç‰‡ grid
        function render(animate = false) {
            const grid = document.getElementById('grid');
            grid.innerHTML = '';
            // ä½¿ç”¨ currentGridItems è€Œä¸æ˜¯ ALL_DATA
            currentGridItems.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'card' + (animate ? ' fade-in' : '');
                // è®“å¡ç‰‡ä¾åºå‡ºç¾ï¼Œå¢åŠ å‹•æ…‹æ„Ÿ
                if (animate) div.style.animationDelay = `${index * 0.05}s`; 
                div.innerHTML = `<div class="emoji">${item.i}</div><div class="label">${item.n}</div>`;
                div.onclick = () => handleTap(item, div);
                grid.appendChild(div);
            });
        }

        window.onload = () => {
            // åˆå§‹åŒ–æ™‚å…ˆæ´—ç‰Œä¸€æ¬¡
            pickRandomGridItems();
            render();
            document.getElementById('quiz-msg').innerText = "é»ä¸€é»ï¼Œå­¸èªªè©±";
        };
    </script>
</body>
</html>
